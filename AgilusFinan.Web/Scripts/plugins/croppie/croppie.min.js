!function(e,t){"function"==typeof define&&define.amd?define(["exports"],t):t("object"==typeof exports&&"string"!=typeof exports.nodeName?exports:e.commonJsStrict={})}(this,function(exports){function e(e){if(e in P)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=B.length;n--;)if(e=B[n]+t,e in P)return e}function t(e,t){e=e||{};for(var n in t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},arguments.callee(e[n],t[n])):e[n]=t[n];return e}function n(e,t,n){var r;return function(){var i=this,o=arguments,a=function(){r=null,n||e.apply(i,o)},s=n&&!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(i,o)}}function r(e){if("createEvent"in document){var t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange")}function i(e,t,n){if("string"==typeof t){var r=t;t={},t[r]=n}for(var i in t)e.style[i]=t[i]}function o(e,t){var n,r=t||new Image;return n=new Promise(function(t){"http"===e.substring(0,4).toLowerCase()&&r.setAttribute("crossOrigin","anonymous"),r.onload=function(){setTimeout(function(){t(r)},1)}}),r.style.opacity=0,r.src=e,n}function a(e,t){window.EXIF||t(0),EXIF.getData(e,function(){var e=EXIF.getTag(this,"Orientation");t(e)})}function s(e,t,n,r){var i=n.width,o=n.height;switch(e.width=n.width,e.height=n.height,t.save(),r){case 2:t.translate(i,0),t.scale(-1,1);break;case 3:t.translate(i,o),t.rotate(180*Math.PI/180);break;case 4:t.translate(0,o),t.scale(1,-1);break;case 5:e.width=o,e.height=i,t.rotate(90*Math.PI/180),t.scale(1,-1);break;case 6:e.width=o,e.height=i,t.rotate(90*Math.PI/180),t.translate(0,-o);break;case 7:e.width=o,e.height=i,t.rotate(-90*Math.PI/180),t.translate(-i,o),t.scale(1,-1);break;case 8:e.width=o,e.height=i,t.translate(0,i),t.rotate(-90*Math.PI/180)}t.drawImage(n,0,0,i,o),t.restore()}function l(){var e,t,n,r,o=this,a=["croppie-container"],s=o.options.viewport.type?"cr-vp-"+o.options.viewport.type:null;o.options.useCanvas=o.options.exif&&window.EXIF,o.data={},o.elements={},e=o.elements.boundary=document.createElement("div"),n=o.elements.viewport=document.createElement("div"),t=o.elements.img=document.createElement("img"),r=o.elements.overlay=document.createElement("div"),o.options.useCanvas?(o.elements.canvas=document.createElement("canvas"),o.elements.preview=o.elements.canvas):o.elements.preview=o.elements.img,e.classList.add("cr-boundary"),i(e,{width:o.options.boundary.width+"px",height:o.options.boundary.height+"px"}),n.classList.add("cr-viewport"),s&&n.classList.add(s),i(n,{width:o.options.viewport.width+"px",height:o.options.viewport.height+"px"}),o.elements.preview.classList.add("cr-image"),r.classList.add("cr-overlay"),o.element.appendChild(e),e.appendChild(o.elements.preview),e.appendChild(n),e.appendChild(r),o.element.classList.add(a),o.options.customClass&&o.element.classList.add(o.options.customClass),m.call(this),o.options.enableZoom&&c.call(o)}function u(e){this.options.enableZoom&&(this.elements.zoomer.value=L(e,4))}function c(){function e(){d.call(a),r=new O(a.elements.preview),i=a.elements.viewport.getBoundingClientRect(),o=z.parse(a.elements.preview)}function t(){p.call(a,{value:parseFloat(l.value),origin:r||new O(a.elements.preview),viewportRect:i||a.elements.viewport.getBoundingClientRect(),transform:o||z.parse(a.elements.preview)})}function n(n){var r,i;r=n.wheelDelta?n.wheelDelta/1200:n.deltaY?n.deltaY/1060:n.detail?n.detail/60:0,i=a._currentZoom+r,n.preventDefault(),e(),u.call(a,i),t()}var r,i,o,a=this,s=a.elements.zoomerWrap=document.createElement("div"),l=a.elements.zoomer=document.createElement("input");s.classList.add("cr-slider-wrap"),l.type="range",l.classList.add("cr-slider"),l.step="0.01",l.value=1,l.style.display=a.options.showZoomer?"":"none",a.element.appendChild(s),s.appendChild(l),a._currentZoom=1,a.elements.zoomer.addEventListener("mousedown",e),a.elements.zoomer.addEventListener("touchstart",e),a.elements.zoomer.addEventListener("input",t),a.elements.zoomer.addEventListener("change",t),a.options.mouseWheelZoom&&(a.elements.boundary.addEventListener("mousewheel",n),a.elements.boundary.addEventListener("DOMMouseScroll",n))}function p(e){var t=this,n=e.transform,r=e.viewportRect,o=e.origin;t._currentZoom=e.value,n.scale=t._currentZoom;var a=h.call(t,r),s=a.translate,l=a.origin;n.x>=s.maxX&&(o.x=l.minX,n.x=s.maxX),n.x<=s.minX&&(o.x=l.maxX,n.x=s.minX),n.y>=s.maxY&&(o.y=l.minY,n.y=s.maxY),n.y<=s.minY&&(o.y=l.maxY,n.y=s.minY);var u={};u[X]=n.toString(),u[A]=o.toString(),i(t.elements.preview,u),T.call(t),v.call(t)}function h(e){var t=this,n=t._currentZoom,r=e.width,i=e.height,o=t.options.boundary.width/2,a=t.options.boundary.height/2,s=t._originalImageWidth,l=t._originalImageHeight,u=s*n,c=l*n,p=r/2,h=i/2,d=-1*(p/n-o),m=d-(u*(1/n)-r*(1/n)),f=-1*(h/n-a),v=f-(c*(1/n)-i*(1/n)),g=1/n*p,w=u*(1/n)-g,y=1/n*h,_=c*(1/n)-y;return{translate:{maxX:d,minX:m,maxY:f,minY:v},origin:{maxX:w,minX:g,maxY:_,minY:y}}}function d(){var e=this,t=e._currentZoom,n=e.elements.preview.getBoundingClientRect(),r=e.elements.viewport.getBoundingClientRect(),o=z.parse(e.elements.preview.style[X]),a=new O(e.elements.preview),s=r.top-n.top+r.height/2,l=r.left-n.left+r.width/2,u={},c={};u.y=s/t,u.x=l/t,c.y=(u.y-a.y)*(1-t),c.x=(u.x-a.x)*(1-t),o.x-=c.x,o.y-=c.y;var p={};p[A]=u.x+"px "+u.y+"px",p[X]=o.toString(),i(e.elements.preview,p)}function m(){function e(e){if(e.preventDefault(),!p){if(p=!0,o=e.pageX,a=e.pageY,e.touches){var r=e.touches[0];o=r.pageX,a=r.pageY}transform=z.parse(c.elements.preview),window.addEventListener("mousemove",t),window.addEventListener("touchmove",t),window.addEventListener("mouseup",n),window.addEventListener("touchend",n),document.body.style[Z]="none",l=c.elements.viewport.getBoundingClientRect()}}function t(e){e.preventDefault();var t=e.pageX,n=e.pageY;if(e.touches){var p=e.touches[0];t=p.pageX,n=p.pageY}var h=t-o,d=n-a,m=c.elements.preview.getBoundingClientRect(),v=transform.y+d,g=transform.x+h,w={};if("touchmove"==e.type&&e.touches.length>1){var y=e.touches[0],_=e.touches[1],x=Math.sqrt((y.pageX-_.pageX)*(y.pageX-_.pageX)+(y.pageY-_.pageY)*(y.pageY-_.pageY));s||(s=x/c._currentZoom);var b=x/s;return u.call(c,b),void r(c.elements.zoomer)}l.top>m.top+d&&l.bottom<m.bottom+d&&(transform.y=v),l.left>m.left+h&&l.right<m.right+h&&(transform.x=g),w[X]=transform.toString(),i(c.elements.preview,w),f.call(c),a=n,o=t}function n(){p=!1,window.removeEventListener("mousemove",t),window.removeEventListener("touchmove",t),window.removeEventListener("mouseup",n),window.removeEventListener("touchend",n),document.body.style[Z]="",d.call(c),v.call(c),s=0}var o,a,s,l,c=this,p=!1;c.elements.overlay.addEventListener("mousedown",e),c.elements.overlay.addEventListener("touchstart",e)}function f(){var e=this,t=e.elements.boundary.getBoundingClientRect(),n=e.elements.preview.getBoundingClientRect();i(e.elements.overlay,{width:n.width+"px",height:n.height+"px",top:n.top-t.top+"px",left:n.left-t.left+"px"})}function v(){var e=this;g.call(e)&&e.options.update.call(e,e.get())}function g(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function w(){var e,t,n,o,a,s=this,l=0,c=1.5,p=1,h={},d=s.elements.preview,m=s.elements.zoomer,v=new z(0,0,p),w=new O,x=g.call(s);x&&!s.data.bound&&(s.data.bound=!0,h[X]=v.toString(),h[A]=w.toString(),h.opacity=1,i(d,h),e=d.getBoundingClientRect(),t=s.elements.viewport.getBoundingClientRect(),n=s.elements.boundary.getBoundingClientRect(),s._originalImageWidth=e.width,s._originalImageHeight=e.height,s.options.enableZoom&&(o=t.width/e.width,a=t.height/e.height,l=Math.max(o,a),l>=c&&(c=l+1),m.min=L(l,4),m.max=L(c,4),p=Math.max(n.width/e.width,n.height/e.height),u.call(s,p),r(m)),s._currentZoom=v.scale=p,h[X]=v.toString(),i(d,h),s.data.points.length?y.call(s,s.data.points):_.call(s),f.call(s))}function y(e){if(4!=e.length)throw"Croppie - Invalid number of points supplied: "+e;var t=this,n=e[2]-e[0],r=t.elements.viewport.getBoundingClientRect(),o=t.elements.boundary.getBoundingClientRect(),a={left:r.left-o.left,top:r.top-o.top},s=r.width/n,l=e[1],c=e[0],p=-1*e[1]+a.top,h=-1*e[0]+a.left,d={};d[A]=c+"px "+l+"px",d[X]=new z(h,p,s).toString(),i(t.elements.preview,d),u.call(t,s),t._currentZoom=s}function _(){var e=this,t=e.elements.preview.getBoundingClientRect(),n=e.elements.viewport.getBoundingClientRect(),r=e.elements.boundary.getBoundingClientRect(),o=n.left-r.left,a=n.top-r.top,s=o-(t.width-n.width)/2,l=a-(t.height-n.height)/2,u=new z(s,l,e._currentZoom);i(e.elements.preview,X,u.toString())}function x(){var e=this,t=e.elements.canvas,n=e.elements.img,r=t.getContext("2d");r.clearRect(0,0,t.width,t.height),t.width=n.width,t.height=n.height,a(n,function(e){s(t,r,n,parseInt(e))})}function b(e){var t=e.points,n=document.createElement("div"),r=document.createElement("img"),o=t[2]-t[0],a=t[3]-t[1];return n.classList.add("croppie-result"),n.appendChild(r),i(r,{left:-1*t[0]+"px",top:-1*t[1]+"px"}),r.src=e.url,i(n,{width:o+"px",height:a+"px"}),n}function E(e,t){var n=t.points,r=n[0],i=n[1],o=n[2]-n[0],a=n[3]-n[1],s=t.circle,l=document.createElement("canvas"),u=l.getContext("2d"),c=o,p=a;return t.outputWidth&&t.outputHeight&&(c=t.outputWidth,p=t.outputHeight),l.width=c,l.height=p,s&&(u.save(),u.beginPath(),u.arc(c/2,p/2,c/2,0,2*Math.PI,!0),u.closePath(),u.clip()),u.drawImage(e,r,i,o,a,0,0,c,p),l.toDataURL(t.format,t.quality)}function C(e,t){var n,r=this,i=[];if("string"==typeof e)n=e,e={};else if(Array.isArray(e))i=e.slice();else{if("undefined"==typeof e&&r.data.url)return w.call(r),v.call(r),null;n=e.url,i=e.points||[]}r.data.bound=!1,r.data.url=n||r.data.url,r.data.points=(i||r.data.points).map(function(e){return parseFloat(e)});var a=o(n,r.elements.img);return a.then(function(){r.options.useCanvas&&(r.elements.img.exifdata=null,x.call(r)),w.call(r),v.call(r),t&&t()}),a}function L(e,t){return parseFloat(e).toFixed(t||0)}function S(){var e=this,t=e.elements.preview.getBoundingClientRect(),n=e.elements.viewport.getBoundingClientRect(),r=n.left-t.left,i=n.top-t.top,o=r+n.width,a=i+n.height,s=e._currentZoom;return(s===1/0||isNaN(s))&&(s=1),r=Math.max(0,r/s),i=Math.max(0,i/s),o=Math.max(0,o/s),a=Math.max(0,a/s),{points:[L(r),L(i),L(o),L(a)],zoom:s}}function M(e){var n,r,i=this,o=S.call(i),a=t(W,t({},e)),s="string"==typeof e?a:a.type,l=a.size,u=a.format,c=a.quality;return"viewport"===l&&(n=i.elements.viewport.getBoundingClientRect(),o.outputWidth=n.width,o.outputHeight=n.height),k.indexOf(u)>-1&&(o.format="image/"+u,o.quality=c),o.circle="circle"===i.options.viewport.type,o.url=i.data.url,r=new Promise(function(e){e("canvas"===s?E.call(i,i.elements.preview,o):b.call(i,o))})}function I(){w.call(this)}function R(){var e=this;e.element.removeChild(e.elements.boundary),e.element.classList.remove("croppie-container"),e.options.enableZoom&&e.element.removeChild(e.elements.zoomerWrap),delete e.elements}function Y(e,n){this.element=e,this.options=t(t({},Y.defaults),n),l.call(this)}"function"!=typeof Promise&&function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function t(e){return"function"==typeof e}function n(e){return"object"==typeof e&&null!==e}function r(e){W=e}function i(e){H=e}function o(){return function(){process.nextTick(c)}}function a(){return function(){T(c)}}function s(){var e=0,t=new Q(c),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function l(){var e=new MessageChannel;return e.port1.onmessage=c,function(){e.port2.postMessage(0)}}function u(){return function(){setTimeout(c,1)}}function c(){for(var e=0;q>e;e+=2){var t=G[e],n=G[e+1];t(n),G[e]=void 0,G[e+1]=void 0}q=0}function p(){try{var e=require,t=e("vertx");return T=t.runOnLoop||t.runOnContext,a()}catch(n){return u()}}function h(){}function d(){return new TypeError("You cannot resolve a promise with itself")}function m(){return new TypeError("A promises callback cannot return that same promise.")}function f(e){try{return e.then}catch(t){return ne.error=t,ne}}function v(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function g(e,t,n){H(function(e){var r=!1,i=v(n,t,function(n){r||(r=!0,t!==n?_(e,n):b(e,n))},function(t){r||(r=!0,E(e,t))},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,E(e,i))},e)}function w(e,t){t._state===ee?b(e,t._result):t._state===te?E(e,t._result):C(t,void 0,function(t){_(e,t)},function(t){E(e,t)})}function y(e,n){if(n.constructor===e.constructor)w(e,n);else{var r=f(n);r===ne?E(e,ne.error):void 0===r?b(e,n):t(r)?g(e,n,r):b(e,n)}}function _(t,n){t===n?E(t,d()):e(n)?y(t,n):b(t,n)}function x(e){e._onerror&&e._onerror(e._result),L(e)}function b(e,t){e._state===V&&(e._result=t,e._state=ee,0!==e._subscribers.length&&H(L,e))}function E(e,t){e._state===V&&(e._state=te,e._result=t,H(x,e))}function C(e,t,n,r){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+ee]=n,i[o+te]=r,0===o&&e._state&&H(L,e)}function L(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var r,i,o=e._result,a=0;a<t.length;a+=3)r=t[a],i=t[a+n],r?I(n,r,i,o):i(o);e._subscribers.length=0}}function S(){this.error=null}function M(e,t){try{return e(t)}catch(n){return re.error=n,re}}function I(e,n,r,i){var o,a,s,l,u=t(r);if(u){if(o=M(r,i),o===re?(l=!0,a=o.error,o=null):s=!0,n===o)return void E(n,m())}else o=i,s=!0;n._state!==V||(u&&s?_(n,o):l?E(n,a):e===ee?b(n,o):e===te&&E(n,o))}function R(e,t){try{t(function(t){_(e,t)},function(t){E(e,t)})}catch(n){E(e,n)}}function Y(e,t){var n=this;n._instanceConstructor=e,n.promise=new e(h),n._validateInput(t)?(n._input=t,n.length=t.length,n._remaining=t.length,n._init(),0===n.length?b(n.promise,n._result):(n.length=n.length||0,n._enumerate(),0===n._remaining&&b(n.promise,n._result))):E(n.promise,n._validationError())}function A(e){return new ie(this,e).promise}function X(e){function t(e){_(i,e)}function n(e){E(i,e)}var r=this,i=new r(h);if(!D(e))return E(i,new TypeError("You must pass an array to race.")),i;for(var o=e.length,a=0;i._state===V&&o>a;a++)C(r.resolve(e[a]),void 0,t,n);return i}function Z(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(h);return _(n,e),n}function B(e){var t=this,n=new t(h);return E(n,e),n}function P(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function j(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(e){this._id=ue++,this._state=void 0,this._result=void 0,this._subscribers=[],h!==e&&(t(e)||P(),this instanceof F||j(),R(this,e))}function z(){var e;if("undefined"!=typeof global)e=global;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;(!n||"[object Promise]"!==Object.prototype.toString.call(n.resolve())||n.cast)&&(e.Promise=ce)}var O;O=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var T,W,k,D=O,q=0,H=({}.toString,function(e,t){G[q]=e,G[q+1]=t,q+=2,2===q&&(W?W(c):k())}),N="undefined"!=typeof window?window:void 0,U=N||{},Q=U.MutationObserver||U.WebKitMutationObserver,J="undefined"!=typeof process&&"[object process]"==={}.toString.call(process),K="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,G=new Array(1e3);k=J?o():Q?s():K?l():void 0===N&&"function"==typeof require?p():u();var V=void 0,ee=1,te=2,ne=new S,re=new S;Y.prototype._validateInput=function(e){return D(e)},Y.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},Y.prototype._init=function(){this._result=new Array(this.length)};var ie=Y;Y.prototype._enumerate=function(){for(var e=this,t=e.length,n=e.promise,r=e._input,i=0;n._state===V&&t>i;i++)e._eachEntry(r[i],i)},Y.prototype._eachEntry=function(e,t){var r=this,i=r._instanceConstructor;n(e)?e.constructor===i&&e._state!==V?(e._onerror=null,r._settledAt(e._state,t,e._result)):r._willSettleAt(i.resolve(e),t):(r._remaining--,r._result[t]=e)},Y.prototype._settledAt=function(e,t,n){var r=this,i=r.promise;i._state===V&&(r._remaining--,e===te?E(i,n):r._result[t]=n),0===r._remaining&&b(i,r._result)},Y.prototype._willSettleAt=function(e,t){var n=this;C(e,void 0,function(e){n._settledAt(ee,t,e)},function(e){n._settledAt(te,t,e)})};var oe=A,ae=X,se=Z,le=B,ue=0,ce=F;F.all=oe,F.race=ae,F.resolve=se,F.reject=le,F._setScheduler=r,F._setAsap=i,F._asap=H,F.prototype={constructor:F,then:function(e,t){var n=this,r=n._state;if(r===ee&&!e||r===te&&!t)return this;var i=new this.constructor(h),o=n._result;if(r){var a=arguments[r-1];H(function(){I(r,i,a,o)})}else C(n,i,e,t);return i},"catch":function(e){return this.then(null,e)}};var pe=z,he={Promise:ce,polyfill:pe};"function"==typeof define&&define.amd?define(function(){return he}):"undefined"!=typeof module&&module.exports?module.exports=he:"undefined"!=typeof this&&(this.ES6Promise=he),pe()}.call(this);var A,X,Z,B=["Webkit","Moz","ms"],P=document.createElement("div").style;X=e("transform"),A=e("transformOrigin"),Z=e("userSelect");var j="translate3d",F=", 0px",z=function(e,t,n){this.x=parseFloat(e),this.y=parseFloat(t),this.scale=parseFloat(n)};z.parse=function(e){return e.style?z.parse(e.style[X]):e.indexOf("matrix")>-1||e.indexOf("none")>-1?z.fromMatrix(e):z.fromString(e)},z.fromMatrix=function(e){var t=e.substring(7).split(",");return t.length&&"none"!==e||(t=[1,0,0,1,0,0]),new z(parseInt(t[4],10),parseInt(t[5],10),parseFloat(t[0]))},z.fromString=function(e){var t=e.split(") "),n=t[0].substring(j.length+1).split(","),r=t.length>1?t[1].substring(6):1,i=n.length>1?n[0]:0,o=n.length>1?n[1]:0;return new z(i,o,r)},z.prototype.toString=function(){return j+"("+this.x+"px, "+this.y+"px"+F+") scale("+this.scale+")"};var O=function(e){if(!e||!e.style[A])return this.x=0,void(this.y=0);var t=e.style[A].split(" ");this.x=parseFloat(t[0]),this.y=parseFloat(t[1])};O.prototype.toString=function(){return this.x+"px "+this.y+"px"};var T=n(f,500),W={type:"canvas",size:"viewport",format:"png",quality:1},k=["jpeg","webp","png"];if(this.jQuery){var $=this.jQuery;$.fn.croppie=function(e){var t=typeof e;if("string"===t){var n=Array.prototype.slice.call(arguments,1),r=$(this).data("croppie");return"get"===e?r.get():"result"===e?r.result.apply(r,n):this.each(function(){var t=$(this).data("croppie");if(t){var r=t[e];if(!$.isFunction(r))throw"Croppie "+e+" method not found";r.apply(t,n),"destroy"===e&&$(this).removeData("croppie")}})}return this.each(function(){var t=new Y(this,e);$(this).data("croppie",t)})}}Y.defaults={viewport:{width:100,height:100,type:"square"},boundary:{width:300,height:300},customClass:"",showZoomer:!0,enableZoom:!0,mouseWheelZoom:!0,exif:!1,update:function(){}},t(Y.prototype,{bind:function(e,t){return C.call(this,e,t)},get:function(){return S.call(this)},result:function(e){return M.call(this,e)},refresh:function(){return I.call(this)},setZoom:function(e){u.call(this,e),r(this.elements.zoomer)},destroy:function(){return R.call(this)}}),exports.Croppie=window.Croppie=Y,"object"==typeof module&&module.exports&&(module.exports=Y)});