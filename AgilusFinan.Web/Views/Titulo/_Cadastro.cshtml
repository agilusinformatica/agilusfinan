@using AgilusFinan.Web.ViewModels
@model TituloViewModel

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    @Html.HiddenFor(model => model.Id)
    @Html.HiddenFor(model => model.TituloRecorrenteId)
    
    <div class="form-horizontal">
        <h4>Titulo</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        
        @Html.Partial("~/Views/Shared/_CadastroTitulo.cshtml", Model)

        <div class="form-group">
            <input type="checkbox" id="estapago" @(Model.Liquidacoes.Count > 0 ? "checked" : "")>
            <label class="control-label col-md-2">Pago?</label>
            <div class="col-md-10" id="divLiquidacoes"
                @{
                    if (Model.Liquidacoes.Count == 0)
                    {
                        <text>style="display: none;"</text>
                    }
                }>
                @Html.Partial("~/Views/Titulo/_Liquidacao.cshtml", Model.Liquidacoes)
            </div>
        </div>

    </div>
    
    <div>
        @Html.ActionLink("Voltar sem gravar", "Index")
    </div>

}


<script>

    $('#estapago').click(function() {
        $('#divLiquidacoes').toggle();
    });

    function UpdateTitulo(manterTela) {
        var tituloJson = CadastroTitulo.getData();
        $.ajax({
            type: "POST",
            url: '/@(Model.TipoTitulo)/@(ViewBag.TipoOperacao == "Incluindo" ? "Create" : "Edit")',
            data: { "postedData": tituloJson },
            success: function () {
                if (manterTela) {
                    window.location = '@Url.Action("Create", Model.TipoTitulo)';
                }
                else {
                    window.location = '@Url.Action("Index", Model.TipoTitulo)';
                }
            }
        });
    }

</script>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

<script>
</script>

<button class="btn btn-default" type="submit" onclick="UpdateTitulo();">Gravar</button>
<button class="btn btn-default" type="submit" onclick="UpdateTitulo(true);">Gravar e incluir um novo</button>